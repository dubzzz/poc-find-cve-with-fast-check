// https://security.snyk.io/vuln/npm:lodash:20180130
const _ = require('lodash-4.17.4');

const { test } = require('@jest/globals');
const fc = require('fast-check');
const { assertNoPoisoning, restoreGlobals } = require('@fast-check/poisoning');

fc.configureGlobal({ afterEach: restoreGlobals });

test('CVE-2018-3721', () => {
  fc.assert(
    fc.property(fc.object(), fc.object(), (raw, other) => {
      // Arrange
      const instance = _.cloneDeep(raw); // just not to alter the original object

      // Act
      _.merge(instance, other);

      // Assert
      assertNoPoisoning();
    }),
    { seed: 1877517344, path: '2:0:1:1:78:78:79:79', endOnFailure: true }
  );
});
// { seed: 1877517344, path: "2:0:1:1:78:78:79:79", endOnFailure: true }
