// https://security.snyk.io/vuln/SNYK-JS-LODASH-567746
const _ = require("lodash-4.17.19");

const { test } = require("@jest/globals");
const fc = require("fast-check");
const { assertNoPoisoning, restoreGlobals } = require("@fast-check/poisoning");

fc.configureGlobal({ afterEach: restoreGlobals });

const pathArbitrary = fc
  .array(fc.string(), { minLength: 1 })
  .map((pathItems) => pathItems.map((item) => `[${item}]`).join(""));

test("CVE-2020-8203", () => {
  fc.assert(
    fc.property(
      fc.array(fc.record({ path: pathArbitrary, value: fc.anything() })),
      (items) => {
        // Arrange
        const paths = items.map((i) => i.path);
        const values = items.map((i) => i.value);

        // Act
        _.zipObjectDeep(paths, values);

        // Assert
        assertNoPoisoning();
      }
    ),
    { seed: 1943176232, path: "79:1:0:0:2:67:67:67:67", endOnFailure: true }
  );
});
// { seed: 1943176232, path: "79:1:0:0:2:67:67:67:67", endOnFailure: true }
